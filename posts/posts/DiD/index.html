<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Andrew C. Baker">
<meta name="dcterms.date" content="2019-09-25">
<meta name="description" content="Short blogpost summarizing key attributes of the new difference-in-differences literature">

<title>Andrew C. Baker - Difference-in-Differences Methodology</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../../../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../../../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">Andrew C. Baker</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../index.html">About</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../files/Baker_CV.pdf">CV</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../research/index.html">Research</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../../posts/index.html">Posts</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/andrew___baker"><i class="bi bi-twitter" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/andrew-baker-09bb6326"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/andrewchbaker"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:andrew.baker@berkeley.edu"><i class="bi bi-envelope" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#methodological-issues" id="toc-methodological-issues" class="nav-link" data-scroll-target="#methodological-issues">Methodological Issues</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#derivation" id="toc-derivation" class="nav-link" data-scroll-target="#derivation">Derivation</a></li>
  </ul></li>
  <li><a href="#identifying-assumptions" id="toc-identifying-assumptions" class="nav-link" data-scroll-target="#identifying-assumptions">Identifying Assumptions</a></li>
  <li><a href="#remedies" id="toc-remedies" class="nav-link" data-scroll-target="#remedies">Remedies</a>
  <ul class="collapse">
  <li><a href="#goodman-bacon-2019" id="toc-goodman-bacon-2019" class="nav-link" data-scroll-target="#goodman-bacon-2019">Goodman-Bacon (2019)</a></li>
  <li><a href="#callaway-and-santanna-2018" id="toc-callaway-and-santanna-2018" class="nav-link" data-scroll-target="#callaway-and-santanna-2018">Callaway and Sant’Anna (2018)</a></li>
  <li><a href="#abraham-and-sun-2019" id="toc-abraham-and-sun-2019" class="nav-link" data-scroll-target="#abraham-and-sun-2019">Abraham and Sun (2019)</a></li>
  <li><a href="#imai-and-kim-2019" id="toc-imai-and-kim-2019" class="nav-link" data-scroll-target="#imai-and-kim-2019">Imai and Kim (2019)</a></li>
  <li><a href="#cengiz-dube-lindner-and-zipperer-2019" id="toc-cengiz-dube-lindner-and-zipperer-2019" class="nav-link" data-scroll-target="#cengiz-dube-lindner-and-zipperer-2019">Cengiz, Dube, Lindner, and Zipperer (2019)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Difference-in-Differences Methodology</h1>
</div>

<div>
  <div class="description">
    Short blogpost summarizing key attributes of the new difference-in-differences literature
  </div>
</div>

<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    Andrew C. Baker 
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            Berkeley Law School
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 25, 2019</p>
    </div>
  </div>
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>In this methodological section I will explain the issues with difference-in-differences (DiD) designs when there are multiple units and more than two time periods, and also the particular issues that arise when the treatment is conducted at staggered periods in time.</p>
<p>In the canonical DiD set-up (e.g.&nbsp;the Card and Kreuger minimum wage study comparing New Jersey and Pennsylvania) there are two units and two time periods, with one of the units being treated in the second period. Graphically, you can think of the relationship as the one presented below:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Under the parallel trends assumption that, <em>ceteris paribus</em>, the two units would have the same change in the outcome variable, the treatment effect is equal to the difference in the outcome variable for the treated unit in period 2 (<span class="math inline">\(Y_2^T\)</span>) and the treated unit in period 1 (<span class="math inline">\(Y_1^T\)</span>), less the same difference in the control unit (<span class="math inline">\(Y_2^C - Y_1^C\)</span>).</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It can be easily shown that the treatment effect (hereafter <span class="math inline">\(\tau\)</span>) shown in the above plot is equvalent to the coefficient on <span class="math inline">\(\delta\)</span> from the regression <span class="math display">\[\tag{1} Y_{it} = \gamma_t POST_t + \gamma_i TREAT_i + \delta POST_t \times TREAT_i + \epsilon_{it}\]</span> where <span class="math inline">\(POST_t\)</span> is an indicator for being in the second period and <span class="math inline">\(TREAT_i\)</span> is an indicator for the treated unit.</p>
</section>
<section id="methodological-issues" class="level1">
<h1>Methodological Issues</h1>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>While the 2x2 DiD treatment effect can easily be calculated in (1), most DiD applications exploit variation across groups and units that receive treatment at different points in time. The coefficient that comes from the two-way fixed effects (TWFE) estimator when there are more than two units and periods is not an easily interperable parameter in the same manner. Numerous papers have now documented that this coefficient is in fact a weighted average of many different treatment effects, and that these weights are often negative and non-intuitive.</p>
<p>For the purposes of explaining the methodological issue I will focus on one paper’s derivation - Goodman-Bacon (2019) [hereinafter GB (2019)] (Multiple papers have derived this result with varying terminology. I will go over the remedies proposed by some of these papers below). According to GB (2019), the general estimator from the TWFE approach is actually a “weighted average of all possible two-group/two-period DiD estimators in the data.”</p>
<p>Under the TWFE approach, researchers estimate the regression with dummies for cross-sectional units (<span class="math inline">\(\alpha_i\)</span>) and time periods (<span class="math inline">\(\alpha_t\)</span>) and a treatment dummy (<span class="math inline">\(D_{it}\)</span>). The POST and TREAT variables are thus subsumed by the fixed effects structure. This regression is generally written as:</p>
<p><span class="math display">\[
\tag{2} y_{it} = \alpha_i + \alpha_t + \beta^{DD} D_{it} + \epsilon_{it}
\]</span></p>
<p>As explained in GB (2019), we know relatively little about what the TWFE DiD value (<span class="math inline">\(\beta^{DD}\)</span>) measures when treatment timing varies, including how it compares mean outcomes across groups and when alternative specifications will work or why they change the estimates. What the GB (2019) derivation shows is that we can think of the TWFE estimator as a weighted average of individual 2x2 DiD estimators, with the weights proportional to group sizes and the variance of the treatment indicators in each pair, which is highest for units treated in the middle of the panel. In addition, GB (2019) shows how some of the 2x2 estimators use units treated at a particular time as the treatment group and <em>never-treated</em> units as a control group, while other use units treated at two different times, with later-treated groups being used as a control <em>before</em> treatment begins, and the earlier-treated group being used as control <em>after</em> its treatment begins.</p>
<p>Furthermore, GB (2019) shows that when the treatment effects do not change over time, <span class="math inline">\(\beta^{DD}\)</span> is the variance-weighted average of cross-group treatment effects, and all of the weights are positive. However, when the treatment effect does vary across time, some of these 2x2 estimates enter the average with negative weights. This is because already-treated units act as controls, and changes in a portion of their treatment effects over time are subtracted from the DiD estimate.</p>
</section>
<section id="derivation" class="level2">
<h2 class="anchored" data-anchor-id="derivation">Derivation</h2>
<p>Assume going forward that we have a balanced panel data set with <span class="math inline">\(T\)</span> periods <span class="math inline">\(t\)</span> and <span class="math inline">\(N\)</span> cross-sectional units <span class="math inline">\(i\)</span> that belong to either an untreated group <span class="math inline">\(U\)</span>, an early treatment group <span class="math inline">\(k\)</span> which receives binary treatment at <span class="math inline">\(t_k^*\)</span>, and late treatment group <span class="math inline">\(l\)</span> that receives a binary treatment at <span class="math inline">\(t_l^* &gt; t_k^*\)</span>. For each group <span class="math inline">\(a\)</span>, it’s sample share is <span class="math inline">\(n_a\)</span> and the share of time it spends treated is <span class="math inline">\(\overline{D}_a\)</span>. Denote <span class="math inline">\(\overline{y}_b^{POST(a)}\)</span> to be the sample mean of <span class="math inline">\(y_{it}\)</span> for units in group <span class="math inline">\(b\)</span> during group <span class="math inline">\(a\)</span>’s post period <span class="math inline">\([t_a^*, T]\)</span>, with <span class="math inline">\(\overline{y}_b^{PRE(a)}\)</span> defined similarly.</p>
<p>First, I’ll replicate the figure from GB (2019) that shows how <span class="math inline">\(\beta^{DD}\)</span> is calculated when there are just the three groups described above - <span class="math inline">\(U\)</span>, <span class="math inline">\(k\)</span>, and <span class="math inline">\(t\)</span>. Here <span class="math inline">\(U\)</span> is never treated, <span class="math inline">\(k\)</span> the early treatment group is treated at <span class="math inline">\(t_k^* = \frac{34}{100} T\)</span> and the late treatment group <span class="math inline">\(l\)</span> receives treatment at <span class="math inline">\(t_l^* = \frac{85}{100}T\)</span>. We denote three sub-periods, the pre-period for group <span class="math inline">\(k\)</span> = <span class="math inline">\(PRE(k) = [0, t_k^* - 1]\)</span>, the middle period when group <span class="math inline">\(k\)</span> is treated but group <span class="math inline">\(l\)</span> is not <span class="math inline">\(MID(k, l) = [t_k^*, t_l^* - 1]\)</span>, and the post-period for group <span class="math inline">\(l\)</span> = <span class="math inline">\(POST(l) = [t_l^*, T]\)</span>. We assume that the treatment effect is equal to 10 for group <span class="math inline">\(k\)</span> and 15 for group <span class="math inline">\(l\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As GB (2019) note, the challenge is to show how the estimates from the TWFE estimation in Equation 2 map to the groups and times depicted in the figure above. GB (2019) shows that in the three group case here, we could form four 2x2 DiDs that can be estimated by Equation 1 on the subsamples of groups and times. I demonstrate the four possible 2x2 designs in the figure below.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In Panels A and B we see that if we consider only one treatment group and the untreated group, the two way fixed effects estimate reduces to the standard 2x2 DiD with the estimate equal to: <span class="math display">\[\hat{\beta}_{jU}^{2x2} = \left(\overline{y}_j^{POST(j)} - \overline{y}_j^{PRE(j)} \right) - \left(\overline{y}_U^{POST(j)} - \overline{y}_U^{PRE(J)} \right), j = k, l \]</span> However, if there are <em>no</em> untreated units in the sample, the TWFE estimator is only estimated by the difference in the timing of the treatments between treatment groups. This is represented in Panel C, where before <span class="math inline">\(t_l^{*}\)</span>, the early unit <span class="math inline">\(k\)</span> acts as the treatment group and the later treated unit <span class="math inline">\(l\)</span> acts as a control. The 2x2 DiD estimator compares the differences in outcome between the window when treatment status varies (<span class="math inline">\(MID(k, l)\)</span>) and the early group’s pre-period (<span class="math inline">\(PRE(k)\)</span>):</p>
<p><span class="math display">\[
\hat{\beta}_{kl}^{2x2, k} = \left(\overline{y}_k^{MID(k, l)} - \overline{y}_k^{PRE(k)} \right) - \left(\overline{y}_l^{MID(k, l)} - \overline{y}_l^{PRE(k)} \right)
\]</span> Panel D shows the opposite situation, where the later group changes treatment after <span class="math inline">\(t_l^{*}\)</span> and the earlier treated unit <span class="math inline">\(k\)</span> acts as the control. Again, the 2x2 compares average outcomes between two periods, here <span class="math inline">\(POST(l)\)</span> and <span class="math inline">\(MID(k, l)\)</span>:</p>
<p><span class="math display">\[
\hat{\beta}_{k, l}^{2x2, l} = \left(\overline{y}_l^{POST(l)} - \overline{y}_l^{MID(k, l)} \right) - \left(\overline{y}_k^{POST(l)} - \overline{y}_k^{MID(k, l)} \right)
\]</span></p>
<p>What’s important to note here is that the already-treated unit <span class="math inline">\(k\)</span> acts as a control even though they are treated, because their treatment assignment indicator does not change over the relevant period. In addition, each one of the four 2x2 estimates in the figure above uses only a fraction of the available data. The DiDs with treated and untreated units use the entire time period, but only for the two respective groups, so their sample shares are (<span class="math inline">\(n_k + n_U\)</span>) and (<span class="math inline">\(n_l + n_U\)</span>). The timing indicator DiDs (Panels C and D) also use only the observations from the two groups, but also use only a portion of the available time periods. <span class="math inline">\(\hat{\beta}_{k,l}^{2x2, k}\)</span> only uses group <span class="math inline">\(l\)</span>’s pre-period, so it’s sample share is <span class="math inline">\((n_k + n_l)(1 - \overline{D}_l)\)</span>, while <span class="math inline">\(\hat{\beta}_{kl}^{2x2, l}\)</span> uses group k’s post-period, so it’s share is <span class="math inline">\((n_k + n_l)\overline{D}_k\)</span>.</p>
<p>In addition, each of the 2x2 DiDs are identified by the treatment indicator variation in the subsample over which it is estimated, and this varies by subsample:</p>
<p><span class="math display">\[\widehat{V}_{jU}^D = n_{jU}(1 - n_{JU})\overline{D}_j(1 - \overline{D}_j), \hspace{0.5cm} j = k, l\]</span></p>
<p><span class="math display">\[\widehat{V}_{kl}^{D, k} = n_{kl}(1 - n_{kl}) \frac{\overline{D}_k - \overline{D}_l}{1 - \overline{D}_l} \frac{1 - \overline{D}_k}{1 - \overline{D}_l}\]</span></p>
<p><span class="math display">\[\widehat{V}_{kl}^{D, l} = n_{kl}(1 - n_{kl}) \frac{\overline{D}_l}{\overline{D}_k} \frac{\overline{D}_k - \overline{D}_l}{\overline{D}_k}\]</span></p>
<p>where <span class="math inline">\(n_{ab} \equiv \frac{n_a}{n_a + n_b}\)</span> is the relative size of groups within each comparison group. The first portion of each variance measure is the concentration, or total size of the groups, while the second portion comes from when the treatment occurs in each sample, and is the variance of the treatment indicator variable scaled by the size of the relevant window. The central result from GB (2019) is that any TWFE estimator is just an average of the 2x2 estimators in Panels A-D, with weights that are based on subsample shares <span class="math inline">\(n\)</span> and variances <span class="math inline">\(\hat{V}\)</span>.</p>
<p>With <span class="math inline">\(K\)</span> timing groups, you can form <span class="math inline">\(K^2 - K\)</span> timing only estimates comparing earlier and later treated groups. With an untreated group <span class="math inline">\(U\)</span> you could form <span class="math inline">\(K\)</span> treated/untreated 2x2 DiDs for a total of <span class="math inline">\(K^2\)</span> DiD estimates. The weights on each of these 2x2 estimates used to construct <span class="math inline">\(\beta^{DD}\)</span> combine the absolute size of the subsample, the relative size of the treatment and control groups in the subsample, and the timing of the treatment in the subsample.</p>
<p>To put this in context, we can derive the weights for <span class="math inline">\(\beta^{DD}\)</span> from the example in the figures above. <span class="math inline">\(t_k^*\)</span> and <span class="math inline">\(t_l^*\)</span> were set so that <span class="math inline">\(\overline{D}_k = 0.66\)</span> and <span class="math inline">\(\overline{D}_l = 0.16\)</span>. For the 2x2 DiDs in Panels A and B the weights given to the 2x2 DiD estimate for the earlier treated group, <span class="math inline">\(s_{kU}\)</span> is greater than the weight given to the DiD for the later-treated group, <span class="math inline">\(s_{lU}\)</span> because <span class="math inline">\(k\)</span> is treated closer to the middle of the panel and has a higher treatment-indicator variance. This is also true for the timing-only 2x2 DiD’s (Panels C and D), where the weights are higher for the earlier treated groups both because it uses more data and because it has a higher treatment variance. If we calculate the weights for our four estimates here we get:</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">

<table class="table" style="margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:center;"> weights </th>
   <th style="text-align:center;"> value </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:center;"> $s_{kU}$ </td>
   <td style="text-align:center;"> 0.37 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> $s_{lU}$ </td>
   <td style="text-align:center;"> 0.22 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> $s_{kl}^k$ </td>
   <td style="text-align:center;"> 0.28 </td>
  </tr>
  <tr>
   <td style="text-align:center;"> $s_{kl}^l$ </td>
   <td style="text-align:center;"> 0.13 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>What is clear from the derivation is that panel length alone can change the DiD estimates substantially, even when each 2x2 DiD estimate is constant. This seems normatively undesirable. In addition, the weights assigned to each 2x2 estimate when aggregating through TWFE OLS are a result of the size of the subsample and the magnitude of the treatment variance. Groups treated closer to the middle of the panel get more weight, which again isn’t intuitively desirable.</p>
</section>
</section>
<section id="identifying-assumptions" class="level1">
<h1>Identifying Assumptions</h1>
<p>The above derivation of the mechanics of TWFE DiD explains how the coefficient is calculated, but doesn’t map the estimates and the weighting to the standard potential outcomes framework for causal inference. GB (2019) follows Callaway and Sant’Anna (2018) and defines the average treatment effect on the treated (ATT) for timing groups <span class="math inline">\(k\)</span> (all firms that receive treatment during a certain period) at time <span class="math inline">\(\tau\)</span> (the “group-time average treatment effect”) as <span class="math display">\[ATT_k(\tau) \equiv E[Y_{i\tau}^1 - Y_{i\tau}^0|k]\]</span> The TWFE DiD averages outcomes in pre- and post-periods, so we can re-define the average <span class="math inline">\(ATT_k(\tau)\)</span> in a date range <span class="math inline">\(W\)</span> with <span class="math inline">\(T_W\)</span> periods: <span class="math display">\[ATT_k(W) \equiv \frac{1}{T_W} \sum_{t \in W} E[Y_{it}^1 - Y_{it}^0 | k]\]</span>.</p>
<p>I won’t re-derive the full potential outcome results from GB (2019), but the main result is that you can decompose his DiD theorem to express the probability limit of the TWFE DiD estimator <span class="math inline">\(\beta^{DD}\)</span> (assuming <span class="math inline">\(T\)</span> is fixed and <span class="math inline">\(N\)</span> grows) as <span class="math display">\[\underset{N \rightarrow \infty}{plim} \hat{\beta}^{DD} = VWATT + VWCT - \Delta ATT\]</span> In this equation VWATT is the “variance-weighted average treatment effect on the treated”, and is just the positively weighted average of ATTs for the units and periods that act as treatment groups across the 2x2 estimates that make up <span class="math inline">\(\beta^{DD}\)</span>, as we derived in the earlier 3-unit example.</p>
<p>VWCT is the “variance-weighted common trend” term, which generalizes the common trend assumption of DiD to a setting with timing variation. VWCT is the average of the difference in counterfactural trends between pairs of groups and different time periods using the weights from the previous decomposition, and captures how differential trends map to bias in the <span class="math inline">\(\hat{\beta}^{DD}\)</span> estimate. Essentially, this captures the fact that different groups might not have the same underlying trend in outcome dynamics, which biases the (really any) DiD estimate.</p>
<p>Finally, the last term <span class="math inline">\(\Delta ATT\)</span> is a weighted sum of the <em>change</em> in treatment effects within each unit’s post-period with respect to another unit’s treatment timing. This term enters the coefficient estimate because already-treated groups act as controls for later-treated groups, and thus the 2x2 estimators (which subtract changes in the control units from changes in the treated units) will subtract <em>both</em> the average change in untreated outcomes <em>and</em> the treatment effect from earlier periods, assuming that the treatment effect takes more than one period to resolve. This can represent a substantial bias in the estimate.</p>
<p>When the treatment effect is constant in every period, then <span class="math inline">\(ATT_k(W) = ATT, \Delta ATT = 0,\)</span> and <span class="math inline">\(VWATT = ATT\)</span>. Any justification for DiD over other approaches, such as generalized synthetic controls or matrix completion, implicitly assumes that <span class="math inline">\(VWCT = 0\)</span>, or that the parallel trends assumption is satisfied. Bias will arise in <span class="math inline">\(\beta^{DD}\)</span> generally under two forms of treatment effect heterogeneity. First, you can have effects that vary across units, but not over time. [NOTE, I WAS CONFUSED BY THIS EARLIER. IT’S NOT THAT THE TREATMENT EFFECTS ARE CONSTANT ACROSS <em>COHORTS</em> BUT THAT THE TREATMENT EFFECT IS CONSTANT EVERY PERIOD FOR A GIVEN UNIT] In this case <span class="math inline">\(\Delta ATT = 0\)</span> and <span class="math inline">\(ATT_k(W) = VWATT = \sum_{k \neq U} ATT_k \times w_k^T\)</span>. Here <span class="math inline">\(w_k^T\)</span> is a function of the decomposition weights, and is a combination of sample shares and treatment variance. In general <span class="math inline">\(w_k^T \neq n_k^*\)</span>. In other words, the weights are not equal to the sample shares, so <span class="math inline">\(\hat{\beta}^{DD}\)</span> will not equal the sample ATT. As explained in GB (2019), because TWFE uses OLS to combine 2x2 DiDs efficiently, the VWATT lies along the bias/variance tradeoff, and the weights deliver efficiency by potentially moving the point estimate away from the sample ATT. Again, the VWATT will give more weight to units treated towards the middle of the panel, so if the treatment effects during that period differ materially from other treatment effects, the coefficient could be biased.</p>
<p>In addition, we could have a circumstance where the treatment effect is time-varying within a treated unit. That is, instead of a constant additive effect (after treatment <span class="math inline">\(Y = Y + \tau\)</span>), there are dynamics to the treatment effect which increase or decrease as time passes. This is likely to be common; when you see “event study” DiD estimates, the post-treatment period usually shows post-treatment trends in the estimated effects. In this case, time-varying treatment effects generate heterogeneity across the 2x2 DiDs by averaging over different post-treatment windows, up-weighting short run effects most likely to appear in the small windows between timing groups, and biasing the estimates away from the VWATT because <span class="math inline">\(\Delta ATT \neq 0\)</span>. If treatment causes a trend-shift or other form of time-varying treatment effect, then <span class="math inline">\(\beta^{DD}\)</span> will use already-treated units as controls and will yield estimates that are too small or even wrong-signed.</p>
</section>
<section id="remedies" class="level1">
<h1>Remedies</h1>
<p>In this section I will briefly review some of the proposals put forward by different authors on how to deal with the weighting and bias issues inherent to the TWFE DiD estimate <span class="math inline">\(\beta^{DD}\)</span>.</p>
<section id="goodman-bacon-2019" class="level2">
<h2 class="anchored" data-anchor-id="goodman-bacon-2019">Goodman-Bacon (2019)</h2>
<p>GB (2019) proposes a series of diagnostic tests to examine the robustness of the TWFE DiD estimate. First, given the decomposition of the individual 2x2 DiD weights, GB (2019) proposes a more effective balancing test for staggered DiD. Existing approaches for evaluating the balance in a timing design involve estimating a linear relationship between a confounded <span class="math inline">\(x_{it}\)</span> and the treatment timing <span class="math inline">\(t_k^*\)</span>, or comparing means between early and late treated groups. However, because control groups include both early and late-treated units, this does not test whether any such imbalance is likely to bias <span class="math inline">\(\beta^{DD}\)</span>. Rather, GB (2019) proposes a single <em>t</em>-test of reweighted balance in <span class="math inline">\(x_{it}\)</span>, which is a proxy for whether <span class="math inline">\(VWCT = 0\)</span>:</p>
<ol type="1">
<li><p>Generate a dummy for whether a unit is an “effective treatment group”, i.e.&nbsp;whether a unit’s weight as a treatment group exceeds its weight as a control group, <span class="math inline">\(B_k = w_k^T - w_k^C \geq 0\)</span>.</p></li>
<li><p>Regressing timing-group means, <span class="math inline">\(\overline{x}_k\)</span> on <span class="math inline">\(B_k\)</span>, weighting by <span class="math inline">\(\left|w_k^T - w_k^C\right|\)</span>.</p></li>
<li><p>The coefficient on <span class="math inline">\(B_k\)</span> then equals the covariate diferences weighted by the actual identifying variation, and the <span class="math inline">\(t\)</span>-statistic tests against the null of no imbalance. You could also test for trends in the confounders by interacting year dummies or a linear trend with <span class="math inline">\(B_k\)</span>.</p></li>
</ol>
<p>In addition, GB (2019) shows how to test the stability of the DiD coefficients by plotting each 2x2 DiD against its weight <span class="math inline">\(w_k^*\)</span>. You can calculate a variety of different conditional expectations over the subgroups, including the average effect and total weights for treated/untreated comparisons, and late/early treatment and early/late treatment comparisons. Adding the weights on the timing-based coefficients from the decomposition show how much of <span class="math inline">\(\beta^{DD}\)</span> comes from timing variation. Finally, you can identify influential observations by comparing the weights, and calculate what percentage of the total 2x2 coefficients drive 50% of the estimate, or whether influential observations have substantially different levels of <span class="math inline">\(\tau\)</span>.</p>
</section>
<section id="callaway-and-santanna-2018" class="level2">
<h2 class="anchored" data-anchor-id="callaway-and-santanna-2018">Callaway and Sant’Anna (2018)</h2>
<p>Callaway and Sant’Anna (2018) [hereinafter CS (2018)] also consider the identification and estimation of treatment effect parameters using DiD with multiple time periods, variation in treatment timing, and where the parallel trends assumption may only hold after conditioning on observables. They propose a two-step estimation strategy with a bootstrap procedure to conduct asymptotically valid inference which can adjust for autocorrelation and clustering.</p>
<p>CS (2018) define the causal parameters of interest in a staggered DiD framework as functionals of the ATE for group <span class="math inline">\(g\)</span> at time <span class="math inline">\(t\)</span>, where a group is defined by when units are first treated (e.g.&nbsp;all firms treated in 2006, 2009, etc.). These causal parameters are called “group-time average treatment effects”. This setting allows you to aggregate the treatment effects by either relative time (i.e.&nbsp;the event study approach) or by calendar time.</p>
<p>To keep the same notation as in CS (2018), assume there are <span class="math inline">\(\mathcal{T}\)</span> periods where <span class="math inline">\(t = 1, \ldots, \mathcal{T}\)</span>, with <span class="math inline">\(D_t\)</span> a binary variable equal to 1 if an individual is treated and 0 otherwise. In addition, define <span class="math inline">\(G_g\)</span> to be a binary variable that is equal to 1 when an individual is first treated in period <span class="math inline">\(g\)</span>, and <span class="math inline">\(C\)</span> as a binary variable equal to 1 for never-treated units. For each unit, exactly one of <span class="math inline">\(G_g\)</span> or <span class="math inline">\(C\)</span> is equal to 1. Denote the generalized propensity score as <span class="math inline">\(p_g(X) = P(G_g = 1 | X, G_g + C = 1)\)</span>, which is the probability that an individual is treated conditional on having covariates <span class="math inline">\(X\)</span> and conditional on being a member of a group <span class="math inline">\(g\)</span> or a control group <span class="math inline">\(C\)</span>.</p>
<p>CS (2018) frames its identification strategy within the potential outcomes framework. Let <span class="math inline">\(Y_t(1)\)</span> and <span class="math inline">\(Y_t(0)\)</span> be the potential outcomes at time <span class="math inline">\(t\)</span> with and without treatment, respectively. The observed outcome in each period can thus be expressed as <span class="math inline">\(Y_t = D_t Y_t(1) + (1 - D_t)Y_t(0)\)</span>. The authors focus on the average treatment effect for individuals first treated in period <span class="math inline">\(g\)</span> at time period <span class="math inline">\(t\)</span>, called the group-time average treatment effect, denoted by: <span class="math display">\[ATT(g, t) = \mathbb{E}[Y_t(1) - Y_t(0) | G_g = 1]\]</span> The assumptions in the CS (2018) framework are of random sampling, parallel trends conditional on covariates, irreversability of treatment (after a unit is treated it is treated for the remainder of the panel), and overlap (the propensity scores are greater than 0 and less than 1).</p>
<p>Given the parameter of interet <span class="math inline">\(ATT(g, t)\)</span>, CS (2018) develop a non-parametric identification strategy for the group-time average treatment effect, which allows for treatment effect heterogeneity and does not make functional form assumptions about the evolution of potential outcomes. Under the assumptions above, the group-time average treatment effect is nonparametrically identified as: <span class="math display">\[ATT(g, t) = \mathbb{E} \left[\left( \frac{G_g}{\mathbb{E}[G_g]} - \frac{\frac{p_g(X)C}{1 - p_g(X)}}{\mathbb{E}\left[\frac{p_g(X)C}{1 - p_g(X)} \right]} \right) \left(Y_t - T_{g - 1}\right)\right]\]</span> This is just a simple weighted average of the “long difference” of the outcome variable, with the weights depending on the propensity score, which are normalized to one. The intuition is to take observations from the control group and group <span class="math inline">\(g\)</span>, omitting other groups, and then up-weight observations from the control group that have characteristics similar to those frequently found in group <span class="math inline">\(g\)</span> and down-weight observations from the control group that are rarely in group <span class="math inline">\(g\)</span>. This reweighting ensures that the covariates of the treatment and control group are balanced. The authors also explain in an appendix how to use their reweighting scheme where future-treated units can be used as controls.</p>
<p>With <span class="math inline">\(ATT(g, t)\)</span> in hand we can aggregate the group-time treatment effects into fewer intrepetable causal effect parameters, which makes interpretation easier, and also increases statistical power and reduces estimation uncertainty. CS (2018) propose doing the following:</p>
<ol type="1">
<li><p>Aggregating <span class="math inline">\(ATT(g, t)\)</span> by timing-group, <span class="math inline">\(\tilde{\theta}_s(g) = \frac{1}{\mathcal{T} - g + 1} \sum_{t = 2}^{\mathcal{T}} 1 \{g \leq t\} ATT(g, t)\)</span>, and combining the group average treatment effect by the size of each group <span class="math inline">\(\theta_s = \sum_{g = 2}^{\mathcal{T}}\tilde{\theta}_s(g) P(G = g)\)</span>.</p></li>
<li><p>Aggregating <span class="math inline">\(ATT(g, t)\)</span> by the length of exposure to treatment (denoted <span class="math inline">\(e\)</span>) to test whether there are dynamic treatment effects (i.e.&nbsp;the treatment effect is explicitly a function of the time since treatment). They consider <span class="math inline">\(\tilde{\theta}_D(e) = \sum_{g = 2}^{\mathcal{T}} \sum_{t = 2}^{\mathcal{T}} 1 \{t - g + 1 = e\} ATT(g, t)P(G = g | t - g + 1 = e)\)</span>. Here <span class="math inline">\(\tilde{\theta}_D(1)\)</span> would be equal to the average (based on group size) treatment effect in one (<span class="math inline">\(e = 1\)</span>) period. This aggregation gives you a properly weighted event-study similar to pre-existing practice, which might be desirable for continuity. In addition, you could then average over all possible values of <span class="math inline">\(e\)</span> to get <span class="math inline">\(\theta_D = \frac{1}{\mathcal{T} - 1} \sum_{e = 1}^{\mathcal{T} - 1} \tilde{\theta}_D(e).\)</span></p></li>
<li><p>Aggregating <span class="math inline">\(ATT(g, t)\)</span> by calendar time involves computing an average treatment effect for all individuals that are treated in period <span class="math inline">\(t\)</span> and then averaging across all periods. Here, <span class="math inline">\(\tilde{\theta}_C(t) = \sum_{g = 2}^{\mathcal{T}} 1 \{g \leq t\} ATT(g, t) P(G = g | g \leq t)\)</span>. <span class="math inline">\(\tilde{\theta}_C(t)\)</span> can be interepreted as the average treatment effect in period <span class="math inline">\(t\)</span> for all groups treated by period <span class="math inline">\(t\)</span>, and you can further aggregate to <span class="math inline">\(\theta_C = \frac{1}{\mathcal{T} - 1} \sum_{t = 2}^{\mathcal{T}} \tilde{\theta}_C(t)\)</span>, which would be the average treatment effect when calendar time matters. This final summary statistic naturally puts the most weight on groups that are treated in the earliest periods, because they enter more of the <span class="math inline">\(ATT(g, t)\)</span> estimates.</p></li>
<li><p>Aggregating <span class="math inline">\(ATT(g, t)\)</span> in the case where the timing of treatment matters, and where there are dynamic treatment effects (probably the most likely reality in real world scenarios). Here CS (2018) considers dynamic treatment effects only for <span class="math inline">\(e \leq e^{'}\)</span> and for groups with at least <span class="math inline">\(e^{'}\)</span> periods of post-treatment data, which removes the impact of selective treatment timing by keeping the same set of groups across all values of <span class="math inline">\(e\)</span>. There is a tradeoff here between the amount of groups you have in your final estimation sample (larger with smaller values of <span class="math inline">\(e^{'}\)</span>) and the length of the exposure that you can estimate (smaller with smaller values of <span class="math inline">\(e^{'}\)</span>). Let <span class="math inline">\(\delta_{gt}(e, e^{'}) = 1\{t - g + 1 = e \}1\{T - g + 1 \geq e^{'}\}1\{e \leq e^{'}\}\)</span>. Thus <span class="math inline">\(\delta_{gt}(e, e^{'})\)</span> is equal to one in the period where group <span class="math inline">\(g\)</span> has been treated for exactly <span class="math inline">\(e\)</span> periods, if group <span class="math inline">\(g\)</span> has at least <span class="math inline">\(e^{'}\)</span> post-treatment periods available, and if the length of exposure <span class="math inline">\(e\)</span> is less than the post-treatment period requirement <span class="math inline">\(e^{'}\)</span>. The average treatment effect for groups in <span class="math inline">\(\delta_{gt}(e, e^{'})\)</span> is given by <span class="math inline">\(\tilde{\theta}_{SD}(e, e^{'}) = \sum_{g = 2}^{\mathcal{T}} \sum_{t = 2}^{\mathcal{T}} \delta_{gt}(e, e^{'}) ATT(g, t)P(G = g | \delta_{gt}(e, e^{'}) = 1)\)</span>. With <span class="math inline">\(\tilde{\theta}_{SD}(e, e^{'})\)</span> we can calculate the average treatment effect for groups with at least <span class="math inline">\(e^{'}\)</span> periods of post-treatment data as <span class="math inline">\(\theta_{SD}(e^{'}) = \frac{1}{\mathcal{T} - e^{'}} \sum_{e = 1}^{\mathcal{T} - e^{'}} \tilde{\theta}_{SD}(e, e^{'})\)</span>.</p></li>
</ol>
</section>
<section id="abraham-and-sun-2019" class="level2">
<h2 class="anchored" data-anchor-id="abraham-and-sun-2019">Abraham and Sun (2019)</h2>
<p>This paper is tightly linked with the Callaway and Sant’Anna paper, but focuses exclusively on the event-study context, where you include leads and lags of the treatment variable instead of a single binary indicator variable. The authors confirm that in the event study context, where the timing of treatment varies across units, lead/lag regressions can produce causally uninterpretable results because they assign non-convex weights to cohort-specific treatment effects. Their proposed method estimates the dynamic effect for each cohort (equivalent to group <span class="math inline">\(G_g\)</span> from CS (2018)), and then calculates the average of cohort-specific estimates.</p>
<p>In the event study context, the TWFE regression with leads and lags of treatments takes the form of:</p>
<p><span class="math display">\[y_{it} = \alpha_i + \alpha_t + \sum_{l = -K}^{-2} \beta_l D_{it}^l + \sum_{l = 0}^L \beta_l D_it^l + \epsilon_{it}\]</span>.</p>
<p>where <span class="math inline">\(D_{it}^l\)</span> is an indicator for being <span class="math inline">\(l\)</span> time periods relative to <span class="math inline">\(i\)</span>’s initial treatment (treatment is <span class="math inline">\(l\)</span> = 0), and <span class="math inline">\(\alpha_i\)</span> and <span class="math inline">\(\alpha_t\)</span> are unit and time fixed effects, as before. AS (2019) focus on the “cohort-specific average treatment effects on the treated” <span class="math inline">\(l\)</span> periods from initial treatment. This is denoted <span class="math inline">\(CATT_{el} = E\left[Y_{i, e + l}^e - Y_{i, e + l}^{\infty} | E_i = e \right]\)</span> where <span class="math inline">\(E_i\)</span> is the time period of initial treatment, and a cohort <span class="math inline">\(e\)</span> is a set of units for which <span class="math inline">\(E_i = e\)</span>; <span class="math inline">\(Y_{it}^{\infty}\)</span> is the counterfactual outcome of unit <span class="math inline">\(i\)</span> if it never received treatment.</p>
<p>The key theoretical result in this paper is that, even when doing an event-study estimation technique rather than a single binary indicator variable, the coefficients on the TWFE lead/lag indicators could be biased, because the weights assigned to the different <span class="math inline">\(CATT\)</span>s are hard to interpret and need not be positive without assuming treatment effect homogeneity. Specifically, the FE estimands for <span class="math inline">\(l\)</span> periods relative to treatment can be written as non-convex averages of not only <span class="math inline">\(CATT_{e, l}\)</span> from that period, but also <span class="math inline">\(CATT_{e, l^{'}}\)</span> from other periods. This is similar to the result in <span class="math inline">\(GB (2019)\)</span> that <span class="math inline">\(\Delta ATT \neq 0\)</span> with dynamic treatment effects, although (I believe) the event study framework does solve some of the odd variance-weighted issues brought up by GB (2019) in the binary indicator context.</p>
<p>The proposed alternative estimation technique in AS (2019) is to use an interacted specification that is saturated in relative time indicators <span class="math inline">\(D_{it}^l\)</span> and cohort indicators <span class="math inline">\(1\{E_i = e\}\)</span> to estimate each <span class="math inline">\(CATT_{el}\)</span>, which they call an “interaction-weighted” (IW) estimator. The DiD under the IW estimator is equivalent to the difference between the average change in outcomes for cohort <span class="math inline">\(e\)</span>, which is exactly <span class="math inline">\(l\)</span> periods relative to treatment, and the average change for cohorts that have not been treated by <span class="math inline">\(t = e + l\)</span> and is estimated simply by <span class="math display">\[Y_{it} = \alpha_i + \alpha_t + \sum_e \sum_{l \neq -1} \delta_{el}(1\{E_i = e\} \cdot D_{it}^l) + \epsilon_{it}\]</span> Finally, you can re-create the standard event-study plots by taking the weighted average over cohorts <span class="math inline">\(e\)</span> for time period <span class="math inline">\(l\)</span>, with the weights equal to the share of each cohort in the relevant periods.</p>
</section>
<section id="imai-and-kim-2019" class="level2">
<h2 class="anchored" data-anchor-id="imai-and-kim-2019">Imai and Kim (2019)</h2>
<p>Imai and Kim (2019) [hereinafter IK (2019)] also consider the impact of TWFE on DiD estimates with multiple periods, and where units can switch in and out of treatment at different periods in time (this is different than, for example, CS (2018) which assumes treatment continues for the rest of the panel). IK (2019) uses a matching framework to propose a multi-period DiD estimator which eliminates the bias in the TWFE estimator. Their matching estimator is equivalent to a weighted two-way fixed effects regression estimator.</p>
<p>Define a within-unit matched set as the group containing the observation of a treated unit from the previous time period if it is under the control condition (treat = <span class="math inline">\(X_{it}\)</span> = 0) and to be an empty set otherwise: <span class="math display">\[\mathcal{M}_{it} = \{(i^{'}, t^{'}) : i^{'} = i, t^{'} = t - 1, X_{i^{'}t^{'}} = 0\}\]</span> The within-time matched set is defined as a group of control observations in the same time period whose prior observations are also under the control condition: <span class="math display">\[\mathcal{N}_{it} = \{(i^{'}, t^{'}) : i^{'} \neq i, t^{'} = t, X_{i^{'}t^{'}} = X_{i^{'}, t^{'} - 1} \}\]</span> And the adjusted set, which contains the control observations in the previous period that share the same unit as those in <span class="math inline">\(\mathcal{N}_{it}\)</span>: <span class="math display">\[ \mathcal{A}_{it} = \{(i^{'}, t^{'}) : i^{'} \neq i, t^{'} = t - 1, X_{i^{'}t^{'}} = X_{i^{'}t} = 0 \} \]</span></p>
<p>With these matched sets and adjustment sets, the multi-period DiD estimator is the average of 2x2 DiD estimators applied whenever there is a change from the control condition to the treatment condition (Note, I believe this methodology just looks at one-period effects, so rules out dynamic treatment effects). Then the treatment effect is <span class="math display">\[\hat{\tau} = \frac{1}{\sum_{i = 1}^N \sum_{t = 1}^T D_{it}} \sum_{i = 1}^N \sum_{t = 1}^T D_{it} \left(\widehat{Y_{it(1)}} - \widehat{Y_{it(0)}} \right)\]</span> where <span class="math inline">\(D_{i1} = 0 \forall i\)</span>, <span class="math inline">\(D_{it} = X_{it} \cdot 1\{|\mathcal{M}_{it}| \cdot |\mathcal{N}_{it}| &gt; 0\}\)</span> for <span class="math inline">\(t &gt; 1\)</span> and for <span class="math inline">\(D_{it} = 1\)</span> we define:</p>
<p><span class="math display">\[\begin{equation}
   \widehat{Y_{it}(x)} = \left\{
       \begin{array}
         YY_{it} &amp; \text{if } X_{it} = 1 \\
         Y_{i, t- 1} + \frac{1}{|\mathcal{N}_{it}|} \sum_{(i^{'}, t) \in \mathcal{N}_{it}} Y_{i^{'}t} -
         \frac{1}{|\mathcal{A}_{it}|} \sum_{(i^{'}, t^{'}) \in \mathcal{A}_{it}} Y_{i^{'}t^{'}} &amp; \text{if } X_{it} = 0
       \end{array}
       \right.
\end{equation}\]</span></p>
<p>In words, this means that when the treatment status of a unit changes from a control (<span class="math inline">\(X_{it} = 0\)</span>) at time <span class="math inline">\(t-1\)</span> to a treatment (<span class="math inline">\(X_{it} = 1\)</span>) at time <span class="math inline">\(t\)</span>, and there exists at least one other unit whose treatment status does not change in the same time periods, the counterfactual outcome for observation <span class="math inline">\((i, t)\)</span> is estimated by substracting from the realized outcome <span class="math inline">\(Y_{it}\)</span>, its own observed previous period outcome <span class="math inline">\(Y_{i, t-1}\)</span>, as well as the average outcome difference between the same two time periods among the other units whose treatment status does not turn on in time <span class="math inline">\(t\)</span>.</p>
<p>With these sets and estimation strategy, the IK (2019) matching based DiD estimator is equivalent to the following weighted two-way fixed effect estimator:</p>
<p><span class="math display">\[\hat{\tau} = \hat{\beta}_{WFE2} =  \underset{\beta}{\text{armin}} \sum_{i = 1}^N \sum_{t = 1}^T W_{it}\{(Y_{it} - \overline{Y}_i^* - \overline{Y}_t^* + \overline{Y}^*) - \beta(X_{it} - \overline{X}_i^* - \overline{X}_t^* + \overline{X}^*) \}^2 \]</span> where asterisks indicate weighted averages and the weights <span class="math inline">\(W_{it}\)</span> are given by:</p>
<p><span class="math display">\[W_{it} = \sum_{i^{'} = 1}^N \sum_{t^{'} - 1}^T D_{i^{'}t^{'}} \cdot w_{it}^{i^{'}t^{'}}\]</span> and</p>
<p><span class="math display">\[\begin{equation}
   w_{it}^{i^{'}t^{'}} = \left\{
       \begin{array}
         11 &amp; \text{if } (i, t) = (i^{'}, t^{'}) \\
         1 / |\mathcal{M}_{i^{'}t^{'}}| &amp; \text{if } (i, t) \in \mathcal{M}_{i^{'}t^{'}} \\
         1 / |\mathcal{N}_{i^{'}t^{'}}| &amp; \text{if } (i, t) \in \mathcal{N}_{i^{'}t^{'}} \\
         (2 X_{it} - 1)(2X_{i^{'}t^{'}}) / |\mathcal{A}_{i^{'}t^{'}} &amp; \text{if } (i, t) \in \mathcal{A}_{i^{'}t^{'}} \\
         0 &amp; \text{otherwise}
       \end{array}
       \right.
\end{equation}\]</span></p>
</section>
<section id="cengiz-dube-lindner-and-zipperer-2019" class="level2">
<h2 class="anchored" data-anchor-id="cengiz-dube-lindner-and-zipperer-2019">Cengiz, Dube, Lindner, and Zipperer (2019)</h2>
<p>CDLZ (2019) estimates the impact of minimum wage changes on low-wage jobs across a series of 138 prominent state-level minimum wage changes between 1979 and 2016 in the United States using a difference-in-differences approach. In Online Appendix D, CDLZ (2019) notes that there are issues in aggregating discrete DiD estimates through OLS, and as a robustness check seperates and plots the distribution of the individual treatment effect for each of the events.</p>
<p>To do this, the authors create 138 event <span class="math inline">\(h\)</span>-specific datasets including the outcome variable and controls for the treated state <span class="math inline">\(h\)</span> and all other “clean controls” that don’t have a material change to the state minimum wage within the eight year estimation window (<span class="math inline">\(t = -3\)</span> to <span class="math inline">\(t = 4\)</span>). For each event, they they then run a one-treated panel DiD based on their baseline strategy:</p>
<p><span class="math display">\[
Y_{sjth} = \sum_{\tau = -3}^4 \sum_{k = -4}^4 \alpha_{\tau k h} \mathcal{I}_{sjth}^{\tau k} + \mu_{sjh} + \rho_{sjth} + u_{sjth}
\]</span> I will ignore the specific subscripts on all the regression terms; in essence this is just a saturated panel DiD with a lead/lag treatment indicator <span class="math inline">\(\mathcal{I}\)</span> and state <span class="math inline">\(\mu\)</span> and time <span class="math inline">\(\rho\)</span> fixed effects.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> CDLZ (2019) then plots the distribution of the <span class="math inline">\(\alpha\)</span> treatment effects, along with their confidence intervals using the Ferman and Pinto (forthcoming) method for heteroskedastic robust cluster residual bootstrapping more appropriate for single-treated units.</p>
<p>CDLZ (2019) also stacks the event-specific data sets to calculate an average effect across all 138 events using a single set of treatment effects. As the authors note, this is an alternative to a baseline TWFE DiD estimate, but “uses a more stringent criteria for admissable control groups, and is more robust to possible problems with a staggered treatment design in the presence of heterogeneous treatment effects.” By stacking and aligning events in event-time, this approach is equivalent to a setting where the events happen contemporaneously, and it prevents negative weighting of some events that may occur with a staggered design. Moreover, by dropping all control states with any state-level minimum wage increases within the 8 year event window, this method guards against bias due to heterogeneous treatment effects that show up in the <span class="math inline">\(\Delta ATT\)</span> term from GB (2019).</p>


</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>The subscripts represent how the indicator and fixed effects are interacted with wage-bin indicators which is irrelevant for the purposes here.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>